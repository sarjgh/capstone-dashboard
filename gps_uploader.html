<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCTI9qiQ0jJPCH_MoQJ5mVjBjvD3zQkpIU",
    authDomain: "capstonedesign-fe014.firebaseapp.com",
    databaseURL: "https://capstonedesign-fe014-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "capstonedesign-fe014",
    storageBucket: "capstonedesign-fe014.appspot.com",
    messagingSenderId: "187566571167",
    appId: "1:187566571167:web:6d596a12d4d8ce34472caa",
    measurementId: "G-HGB4T76H6S"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  function uploadLocation(position) {
    const lat = position.coords.latitude;
    const lng = position.coords.longitude;
    const now = new Date().toISOString();

    document.getElementById("lat").innerText = `ğŸ“ ìœ„ë„: ${lat}`;
    document.getElementById("lng").innerText = `ğŸ“ ê²½ë„: ${lng}`;
    document.getElementById("timestamp").innerText = `ğŸ•’ ë§ˆì§€ë§‰ ì „ì†¡ ì‹œê°„: ${now}`;

    const data = {
      latitude: lat,
      longitude: lng,
      timestamp: now,
      error: 0
    };

    db.ref("gps_logs").push(data);
  }

  function handleError(err) {
    document.getElementById("lat").innerText = "âŒ ìœ„ì¹˜ ì˜¤ë¥˜: " + err.message;
    document.getElementById("lng").innerText = "";
    document.getElementById("timestamp").innerText = "";
  }

  // âœ… 3ì´ˆë§ˆë‹¤ GPS ìš”ì²­
  if (navigator.geolocation) {
    setInterval(() => {
      navigator.geolocation.getCurrentPosition(uploadLocation, handleError, {
        enableHighAccuracy: true,
        timeout: 10000
      });
    }, 3000);
  } else {
    document.getElementById("lat").innerText = "âš ï¸ ì´ ê¸°ê¸°ì—ì„œ ìœ„ì¹˜ ì‚¬ìš© ë¶ˆê°€.";
  }
</script>
